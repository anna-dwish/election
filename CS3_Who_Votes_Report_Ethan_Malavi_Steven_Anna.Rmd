---
title: "Case Study 3 Interim Report: Who Votes in North Carolina?"
author: "Ethan Shen, Malavi Ravindran, Steven Herrera Tenorio, Anna Darwish"
geometry: "left=1.25cm,right=1.25cm,top=1.3cm,bottom=1.3cm"
fontsize: 12pt
output: 
  pdf_document:
     number_sections: true
---

```{r, function checking for installed packages, include=FALSE}
# Validate that all necessary packaged have been downloaded, install otherwise or throw err package DNE
pkgTest <- function(x)
{
  if (!require(x,character.only = TRUE))
  {
    install.packages(x,repos = "http://cran.r-project.org", dep=TRUE)
    if(!require(x,character.only = TRUE)) stop("Package not found")
  }
}
```

```{r package test, include=FALSE}
pkgTest("arm")
pkgTest("brms")
pkgTest("cvAUC")
pkgTest("cvms")
pkgTest("dplyr")
pkgTest("ggplot2")
pkgTest("glmnet")
pkgTest("grid")
pkgTest("gridExtra")
pkgTest("groupdata2")
pkgTest("knitr")
pkgTest("lme4")
pkgTest("lmerTest")
pkgTest("maps")
pkgTest("merTools")
pkgTest("optimx")
pkgTest("pander")
pkgTest("plyr")
pkgTest("scales")
pkgTest("sf")
pkgTest("tidyr")
pkgTest("tidyverse")
```

```{r load packages, include=FALSE}
library(brms)
library(cvAUC)
library(cvms)
library(dplyr)
library(ggplot2)
library(glmnet)
library(grid)
library(gridExtra)
library(groupdata2)
library(knitr)
library(lme4)
library(lmerTest)
library(maps)
library(merTools)
library(optimx)
library(pander)
library(plyr)
library(scales)
library(sf)
library(tidyr)
library(tidyverse)
knitr::opts_chunk$set(echo = F,
                      message = F,
                      warning = F)
theme_set(theme_classic())
```

# Introduction

In 2019, the Supreme Court asserted that federal courts were not allowed to rule cases on partisan gerrymandering, which allows parties that control the state legislature to draw district maps and influence election outcomes (Rucho v. Common Cause 2019) [[1]][Bibliography]. North Carolina was at the spotlight of this contested 5-4 ruling, cultivating national dialogue about the consequences of district map drawing, such as voter suppression. Our study aims to uncover demographic characteristics, such as race, gender, age group, and county of residence, that drive voting patterns in North Carolina. We ultimately seek to answer the following question -- *who* votes in North Carolina? Answering this will not only allow for better predictions for the outcomes of Congressional elections, but will also illuminate which demographic groups in the state are hindered from civic engagement, whether by implicit or explicit means. This information can be instrumental to campaigns and activist groups that are seeking to bolster support and foster more politically minded communities. 

Our study will use publicly available voter and registration data in order to determine the number of likely and unlikely voters across various demographic groups in the 100 counties and 13 congressional districts of North Carolina. After performing data munging and harmonization, we implement a multilevel logistic regression model with a random county intercept and random district intercept to make statements regarding an individual's likelihood of voting. In order to assess the performance of the model, we perform both 5-fold cross validation and out of sample validation using data from the 2012 elections. We conclude with a discussion of which demographic characteristics have a significant impact on the likelihood of voting, quantifications of these relationships, and limitations to our data and analysis.

# Data Description

The North Carolina voter history dataset shows how each registered voter, uniquely identified by a voter registration number, voted in elections over the last 10 years. As not all voters participate in all elections, we designated only those who voted in 2016 as “likely” voters for the 2020 election. This decision was made due to the similarities between the 2016 and 2020 presidential election years, such as the incumbent candidate and a hyper-polarized political environment [[2]][Bibliography]. We elected to omit voter information from the 2018 midterm election as turnout for midterm elections is typically not comparable to that of the presidential [[3]][Bibliography]. 

The North Carolina voter registration dataset contains all legally available voter specific information for eligible voters in the state. Individuals for whom the most recent last voted date was greater than ten years were not included in the dataset. Information provided for each voter includes their unique voter registration number, county and district of residence, race, ethnicity, gender, age, and party affiliation. In this dataset, race could take on one of the following categories: Asian, Black or African American, American Indian or Alaska Native, Two or more races, Other, Native Hawaiian or Pacific Islander, Undesignated, and White. Ethnicity was one of the following: Hispanic or Latino, Not Hispanic or Not Latino, and Undesignated. Gender belonged to one of: Male, Female, and Undetermined. Finally, party affiliation included Democrat, Republican, Unaffiliated, Libertarian, Green, and Constitution.

Recall that, in our study, a "likely" voter was one who voted in the 2016 election. Therefore, "unlikely" voters are ones who voted at least once in the last 10 years, but not in the 2016 election.

Next, certain modifications were made to facilitate analysis. Firstly, age was converted to a categorical variable, age bin, which belonged to one of five categories: 18-29, 30-39, 40-49, 50-64, and 65+. In addition, the individual race and ethnic identities were combined into a race/ethnicity variable with categories: Hispanic any race, Non Hispanic White, Non Hispanic Black, Non Hispanic Other, Non Hispanic Asian, Non Hispanic Multi-Racial, Non Hispanic American Indian or Alaska Native, Non Hispanic Native Hawaiian or Pacific Islander, and Undetermined. For gender, we chose to limit our analysis to include Female and Male as most of the subgroups did not include Undetermined gender groups. Finally, we only included registered Democrats, Republicans, and Unaffiliated groups.

While congressional district lines have changed over the course of the past few presidential election years, we maintained the 2020 congressional district lines for our final dataset to better understand who votes within these boundaries. Given that some voters had registered in areas that were re-districted later on, there were some missing values for district in the dataset. For those individuals whose counties reside wholly in one district, we simply assigned them to their 2020 congressional district. For counties that are split between two districts, we split the "likely" and "unlikely" voters evenly between the two districts.

Once these modifications were made, the data was grouped by county, congressional district, race/ethnicity, age bin, gender, and party affiliation. Additionally, for each group we included the number of registered voters that voted in 2016 and didn't vote. For example, one row of the grouped data frame would report the number of registered 2016 voters that did and didn't vote among 18-29 year old Hispanic women that are registered Democrats in Alamance county.

# Exploratory Data Analysis

```{r Read Data}
# who_votes_data <- readRDS("who_votes_data_2016.Rds")
who_votes_data <- read_csv("grouped_voter_data_2016.csv")
who_votes_data <- who_votes_data %>% filter(!is.na(gender))
who_votes_data <- who_votes_data %>% filter(race_ethnicity != "Non-Hispanic Other")
```

```{r EDA p1, fig.width=9, fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
# This code chunk prefaces some of the other package load-ins because of conflicts with select fuctionality 
who_votes_data %>% 
  mutate(sums = Likely + Unlikely) %>%
  mutate(race_ethnicity = case_when(
    race_ethnicity == "Hispanic Any Race" ~ paste0("Hispanic Any Race (n=",
                                                   who_votes_data %>%
                                                     mutate(sums = Likely + Unlikely) %>%
                                                     filter(race_ethnicity == "Hispanic Any Race") %>%
                                                     summarise(sum(sums)),
                                                   ")"),
    race_ethnicity == "Non-Hispanic American Indian" ~ paste0("Non-Hispanic American Indian (n=",
                                                   who_votes_data %>%
                                                     mutate(sums = Likely + Unlikely) %>%
                                                     filter(race_ethnicity == "Non-Hispanic American Indian") %>%
                                                     summarise(sum(sums)),
                                                   ")"),
    race_ethnicity == "Non-Hispanic Asian" ~ paste0("Non-Hispanic Asian (n=",
                                                   who_votes_data %>%
                                                     mutate(sums = Likely + Unlikely) %>%
                                                     filter(race_ethnicity == "Non-Hispanic Asian") %>%
                                                     summarise(sum(sums)),
                                                   ")"),
    race_ethnicity == "Non-Hispanic Black" ~ paste0("Non-Hispanic Black (n=",
                                                   who_votes_data %>%
                                                     mutate(sums = Likely + Unlikely) %>%
                                                     filter(race_ethnicity == "Non-Hispanic Black") %>%
                                                     summarise(sum(sums)),
                                                   ")"),
    race_ethnicity == "Non-Hispanic Mixed" ~ paste0("Non-Hispanic Multi-Racial (n=",
                                                   who_votes_data %>%
                                                     mutate(sums = Likely + Unlikely) %>%
                                                     filter(race_ethnicity == "Non-Hispanic Mixed") %>%
                                                     summarise(sum(sums)),
                                                   ")"),
    race_ethnicity == "Non-Hispanic White" ~ paste0("Non-Hispanic White (n=",
                                                   who_votes_data %>%
                                                     mutate(sums = Likely + Unlikely) %>%
                                                     filter(race_ethnicity == "Non-Hispanic White") %>%
                                                     summarise(sum(sums)),
                                                   ")")
  )) %>%
  dplyr::select(race_ethnicity, age_bin, gender,Likely,Unlikely) %>%
  dplyr::group_by(race_ethnicity, age_bin, gender) %>% 
  dplyr::summarize(Likely = sum(Likely), 
                   Unlikely = sum(Unlikely), 
                   proportion = Likely/(Likely+Unlikely)) %>% ungroup() %>% 
  ggplot(aes(x = age_bin, y = proportion, fill = gender)) + 
  geom_bar(stat = "identity", position = "dodge") + 
  facet_wrap(~race_ethnicity, nrow = 2) + 
  geom_text(aes(label=paste0(sprintf("%.2f", proportion)), y=proportion/2), 
            position = position_dodge(width = 1),  
            colour="Black", 
            size = 2.2) + 
  labs(x = expression("Age Group"), 
       y= ("Proportion of Likely Voters"), 
       title = "Likely Voters Across Age Groups, Race/Ethnicity, and Sex", 
       caption="Figure 1a") +
  theme(plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 12)) +
  guides(fill=guide_legend(title="Sex"))
```

```{r EDA party, fig.width=9, fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
# This code chunk prefaces some of the other package load-ins because of conflicts with select fuctionality 
edap1b <- who_votes_data %>% 
  mutate(sums = Likely + Unlikely) %>%
  mutate(race_ethnicity = case_when(
    race_ethnicity == "Hispanic Any Race" ~ paste0("Hispanic Any Race (n=",
                                                   who_votes_data %>%
                                                     mutate(sums = Likely + Unlikely) %>%
                                                     filter(race_ethnicity == "Hispanic Any Race") %>%
                                                     summarise(sum(sums)),
                                                   ")"),
    race_ethnicity == "Non-Hispanic American Indian" ~ paste0("Non-Hispanic American Indian (n=",
                                                   who_votes_data %>%
                                                     mutate(sums = Likely + Unlikely) %>%
                                                     filter(race_ethnicity == "Non-Hispanic American Indian") %>%
                                                     summarise(sum(sums)),
                                                   ")"),
    race_ethnicity == "Non-Hispanic Asian" ~ paste0("Non-Hispanic Asian (n=",
                                                   who_votes_data %>%
                                                     mutate(sums = Likely + Unlikely) %>%
                                                     filter(race_ethnicity == "Non-Hispanic Asian") %>%
                                                     summarise(sum(sums)),
                                                   ")"),
    race_ethnicity == "Non-Hispanic Black" ~ paste0("Non-Hispanic Black (n=",
                                                   who_votes_data %>%
                                                     mutate(sums = Likely + Unlikely) %>%
                                                     filter(race_ethnicity == "Non-Hispanic Black") %>%
                                                     summarise(sum(sums)),
                                                   ")"),
    race_ethnicity == "Non-Hispanic Mixed" ~ paste0("Non-Hispanic Multi-Racial (n=",
                                                   who_votes_data %>%
                                                     mutate(sums = Likely + Unlikely) %>%
                                                     filter(race_ethnicity == "Non-Hispanic Mixed") %>%
                                                     summarise(sum(sums)),
                                                   ")"),
    race_ethnicity == "Non-Hispanic White" ~ paste0("Non-Hispanic White (n=",
                                                   who_votes_data %>%
                                                     mutate(sums = Likely + Unlikely) %>%
                                                     filter(race_ethnicity == "Non-Hispanic White") %>%
                                                     summarise(sum(sums)),
                                                   ")")
  )) %>%
  dplyr::select(race_ethnicity, age_bin, party_cd,Likely,Unlikely) %>%
  dplyr::group_by(race_ethnicity, age_bin, party_cd) %>% 
  dplyr::summarize(Likely = sum(Likely), 
                   Unlikely = sum(Unlikely), 
                   proportion = Likely/(Likely+Unlikely)) %>% ungroup() %>% 
  ggplot(aes(x = age_bin, y = proportion, fill = party_cd)) + 
  geom_bar(stat = "identity", position = "dodge") + 
  facet_wrap(~race_ethnicity, nrow = 2) + 
  geom_text(aes(label=paste0(sprintf("%.2f", proportion)), y=proportion/2), 
            position = position_dodge(width = 1),  
            colour="Black", 
            size = 2.2) + 
  labs(x = expression("Age Group"), 
       y= ("Proportion of Likely Voters"), 
       title = "Likely Voters Across Age Groups, Race/Ethnicity, and Party Affiliation", 
       caption="Figure 1b") +
  theme(plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 12)) +
  guides(fill=guide_legend(title="Party"))
```

```{r EDA gender, fig.width=9, fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
# This code chunk prefaces some of the other package load-ins because of conflicts with select fuctionality 
edap1c <- who_votes_data %>% 
  mutate(sums = Likely + Unlikely) %>%
  dplyr::select(gender, age_bin, party_cd,Likely,Unlikely) %>%
  dplyr::group_by(gender, age_bin, party_cd) %>% 
  dplyr::summarize(Likely = sum(Likely), 
                   Unlikely = sum(Unlikely), 
                   proportion = Likely/(Likely+Unlikely)) %>% ungroup() %>% 
  ggplot(aes(x = age_bin, y = proportion, fill = party_cd)) + 
  geom_bar(stat = "identity", position = "dodge") + 
  facet_wrap(~gender, nrow = 1) + 
  geom_text(aes(label=paste0(sprintf("%.2f", proportion)), y=proportion/2), 
            position = position_dodge(width = 1),  
            colour="Black", 
            size = 2.2) + 
  labs(x = expression("Age Group"), 
       y= ("Proportion of Likely Voters"), 
       title = "Likely Voters Across Age Groups, Gender, and Party Affiliation", 
       caption="Figure 1c") +
  theme(plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 12)) +
  guides(fill=guide_legend(title="Party"))
```

In Figure 1a, we can see the proportion of 2016 voters across race/ethnicity, gender, and age group identities. There appears to be profound differences in 2016 voter proportion among the different race-ethnicity groups. *Non-Hispanic American Indian*, *Non-Hispanic Black*, and *Non-Hispanic White* groups generally have a much higher proportion of 2016 voters relative to other groups in North Carolina.

In general, we see an increasing trend in the proportion of 2016 voters with age. However, this effect appears to be steeper for *Non-Hispanic American Indian*, *Non-Hispanic Black*, *Non-Hispanic White*, and *Non-Hispanic Multi-Racial* groups. This trend points to a potential interaction effect between gender and race/ethnicity.

There appears to be a higher proportion of 2016 voters among women compared to men. However, we see this trend level off in the two oldest age groups for most of the race/ethnicity groups.

In Figure 1b in the Appendix, we generally see a steady increase in voter participation with age across registered Democrats, Republicans, and Unaffiliated voters. The relative voter participation within a given age and race/ethnicity group is fairly consistent, with Republicans having a higher likelihood of voting. However, among *Non-Hispanic Black* voters, registered Democrats have a higher voter participation relative Republican and Unaffiliated *Non-Hispanic Black* voters.

Finally in Figure 1c, there does not appear to be a notable difference in voter participation across registered Democrats, Republicans, and Unaffiliated voters between men and women.

```{r EDA county map, fig.width=5.5, fig.height=2.5,fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
# http://www.peterhaschke.com/r/2013/12/05/NCmaps.html
map <- map_data("county")
nc <- subset(map, region =="north carolina")
nc$subregion <- toupper(nc$subregion)
nc <- nc %>% dplyr::rename(county_desc=subregion)
likely.by.county <- who_votes_data %>% dplyr::select(everything()) %>%
  dplyr::group_by(county_desc) %>% 
  dplyr::summarise(Likely=sum(Likely),
                   Unlikely=sum(Unlikely),
                   Prop=sum(Likely)/(sum(Likely) + sum(Unlikely)))
mapdata <- merge(nc, likely.by.county, by = "county_desc")
# fix gray background, make lines darker, find a better color than purple, make borders lighter color
ggplot(data=mapdata) + 
  labs(caption="Figure 2a") +
  geom_polygon(aes(x=long, y=lat, group = group, fill = Prop),colour = "#202020", size=.8) +
  scale_fill_gradient2(high="#454545", low="#b1b1b1", "% Likely Voters", labels = percent) +
  theme(legend.title = element_text(size = 10), axis.text = element_blank(), axis.ticks = element_blank(), axis.title = element_blank(),
    panel.grid = element_blank(), legend.position=c(.2,.2), plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 12), 
    legend.key.width = unit(1.7,"line"), legend.key.height = unit(.8,"line")) +
  guides(fill = guide_colorbar(title.position = "top", direction = "horizontal"), shape = guide_legend(override.aes = list(size = 0.5))) 

eda2b <- ggplot(data=mapdata) + 
  labs(caption="Figure 2b") +
  geom_polygon(aes(x=long, y=lat, group = group, fill = Likely/1000),colour = "#202020", size=.8) +
  scale_fill_gradient2(high="#454545", mid="#c4c4c4", "Count of Likely Voters By County") +
  theme(legend.title = element_text(size = 10), axis.text = element_blank(), axis.ticks = element_blank(), axis.title = element_blank(),
    panel.grid = element_blank(), legend.position=c(.3,.2), plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 12), 
    legend.key.width = unit(1.4,"line"), legend.key.height = unit(.8,"line")) +
  guides(fill = guide_colorbar(title.position = "top", direction = "horizontal"), shape = guide_legend(override.aes = list(size = 0.5))) 
```

```{r EDA district map, fig.width=5.5, fig.height=2.5,fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
# https://beanumber.github.io/mdsr2e/ch-spatial.html#congressional-districts
dsn_districts <- read_sf(dsn = "districtShapes", layer = "districts113")
districts <-  dsn_districts %>% mutate(DISTRICT = parse_number(as.character(DISTRICT)))
nc_shp <- districts %>% filter(STATENAME == "North Carolina")

likely.by.district <- who_votes_data %>% dplyr::select(everything()) %>%
  dplyr::group_by(cong_dist_abbrv) %>% 
  dplyr::summarise(Likely=sum(Likely),
                   Unlikely=sum(Unlikely),
                   Prop=sum(Likely)/(sum(Likely) + sum(Unlikely)))

likely.by.district$cong_dist_abbrv <- as.double(likely.by.district$cong_dist_abbrv)

nc_merged <- nc_shp %>%
  st_transform(4326) %>%
  inner_join(likely.by.district, by = c("DISTRICT" = "cong_dist_abbrv"))

eda2c <- ggplot(data = nc_merged, aes(fill = Prop)) + 
  geom_sf(alpha = 0.5) +
  scale_fill_gradient2(high="#252525", mid="#e1e1e1", "% Likely Voters", labels = percent) +
  geom_sf_label(aes(label = DISTRICT), fill = "white") + 
  theme_void()

eda2d <- ggplot(data = nc_merged, aes(fill = Likely/1000)) + 
  geom_sf(alpha = 0.5) +
  scale_fill_gradient2(high="#252525", mid="#e1e1e1", "Count Likely Voters") +
  geom_sf_label(aes(label = DISTRICT), fill = "white") + 
  theme_void()
```

In Figure 2a, we see how the proportion of 2016 voters varies throughout North Carolina. Heterogeneity among the counties motivates a consideration of a random county intercept in modelling the likelihood of voting. We will address a few trends from this map. Cherokee county, which is the westernmost county in the state, has an extremely high proportion of 2016 voters. This county is 95% White and heavily Republican, with 75% of the vote share going to Donald Trump in 2016. Watauga County, located slightly northeast of Cherokee, similarly shows a high proportion of 2016 voters. However, despite being similar in racial composition to Cherokee (96% White), growth of a younger voting population brought forth by Appalachian State University has turned Watauga into a hotly contested swing county [[5]][Bibliography]. Figure 2c in the Appendix displays a similar heat map with the proportion of 2016 voters across congressional district lines. Given that our goal is to better understand voting behavior for the 2020 elections, we chose to use 2020 congressional district lines. Figure 4b in the Appendix shows that  within a given district, voter proportion is notably different across counties. This suggests our final model will need to incorporate county-granular information. Figures 2b and 2d in the Appendix show these same plots, but with counts instead of proportions. Note that the counts are in thousands of people.

# Methods

We conducted exploratory data analysis to get a sense of which covariates were influential in determining likelihood to vote, along with any possible interactions. This led to a starting model with main effects for gender, age, party, and race/ethnicity, an interaction effect between age and race/ethnicity, and random intercepts for district and county. Some possible effects we were interested in exploring given our initial data analysis were random slopes for age, race, gender, and party, along with interaction effects between age and race, party and race, and age and gender.

In order to compare different models, we began by examining their in-sample, or 2016, F1-score and their F1-score in the 2012 elections. This provided us with an overview with each model's fit and its ability to generalize to a different election year. Table 5 in the Appendix has a summary of each model we explored, their in-sample and out-sample F1-scores, and their in-sample false negative rate. Note that all models had main effect terms for age, race/ethnicity, gender, and party affiliation. After this initial look into the models' performances, we began examining their residual plots and confusion matrices. A common trend was a consistent issue of disproportionate false negatives, along with a strong curve downwards for higher predicted probabilities. Despite exploring a multitude of models with different interactions and random slopes, we could not find a combination that significantly negated this issue. Given that our goal is to provide insight into likely voters, we decided to prioritize models with a lower false negative rate on the training set, as the F1-scores were quite similar to one another. Our focus on the model's performance in the 2016 election stems from our priority to predict in the 2020 election, which shares a candidate and similar issues of divisive policies between demographic groups [[9]][Bibliography]. This motivated us to select the following model as our final model: 

$$ 
\begin{aligned}
log(\frac{P_{ijk}}{1-P_{ijk}}) = \alpha_{0} + \alpha_{j} + \alpha_{k} + \alpha_{3} * I(Gender_{ijk}=Male &) + \sum_{a = 2}^5\alpha_{4a}*I(Age_{ijk}=a) + \sum_{p = 2}^{3}\alpha_{5r}*I(Party_{ijk}=p) +\ \\
 \sum_{r =  2}^{6}\alpha_{6r}*I(Race/ Ethnicity_{ijk}=r)   + \sum_{p = 2}^{3}\sum_{r =  2}^6&\gamma_{1pr}*I (Party_{ijk} = p)*I(Race/Ethnicity_{ijk}=r) \\
\alpha_j \sim N(0,\tau_0^2), & \ \alpha_k \sim N(0,\tau_1^2)
\end{aligned}
$$

$P_{ijk}$ is the probability that individual $i$ from county $j$ in district $k$ voted in the 2016 election. $\alpha_j$ represents the random intercept term for county $j$, and $\alpha_k$ represents the random intercept term for district $k$. For the *Age* term, $a=1$ represents our baseline, which is $65+$ year olds. For our *Race/Ethnicitiy* term,  $r=1$, our baseline group, was *Hispanic Any Race*. Finally, there are three party groups and six race/ethnicity groups, yielding eighteen possible combinations. Eight of these involve the baseline terms, leaving ten other combinations to appear as evaluated terms in the interaction effect of our model.

This final model yielded an F1-score of 0.654 in the 2016 election and 0.748 on the 2012 election. Another model we considered selecting had the same covariates as this one, but with a random age slope over each county and an interaction between age slope and race/ethnicity. While the age slope model had the best F1-scores in the 2016 and 2012 elections (0.6782 and 0.8027 respectively), it also had the worst false negative rates in the 2016 election. Removing the random age slope and interaction between age slope and race/ethnicity yielded one of the lowest false negative rates in the 2016 election among all of the models we explored. Further, while the interaction between race/ethnicity and age was significant, the model with both interactions and no age slope only marginally performed better than one without the interaction and had a higher false negative rate. Removing this interaction yielded our final model with a single interaction between race/ethnicity and party, a random intercept for county, and a random intercept for congressional district. This model had a false negative rate of 0.228.

In terms of sensitivity analysis, our priority was to validate our coefficient estimates, as there can be convergence issues with random effect models within a frequentist framework. We began by recreating our final model with a Bayesian approach. For this model, we relied on relatively flat priors and noticed that virtually all of the coefficients converged to be within two standard errors of our estimates from the frequentist approach. The results of this model are in Table 9 in the Appendix. Relative to the random age slope model we discussed in the previous paragraph, many of the coefficients were within two standard errors of each other, except for the age bin fixed effects. In addition to sensitivity analysis for our variable estimates, we also re-binned the age groups by collapsing them into: $18-39$, $40-64$, and $65+$. We then recreated our final model and observed similar estimates for the other covariates, which can be found in Table 10 in the Appendix.

# Results

```{r Relevel age bins}
who_votes_data$age_bin <- relevel(who_votes_data$age_bin %>% as.factor(), ref = "65+")
who_votes_data$cong_dist_abbrv <- as.character(who_votes_data$cong_dist_abbrv)
```

```{r cross validation, warning=FALSE, message=F, cache=TRUE}
set.seed(5934512)
fold_df <- groupdata2::fold(who_votes_data, k = 5, cat_col = c("age_bin", "race_ethnicity", "cong_dist_abbrv")) %>%
  dplyr::mutate(vote = ifelse(Likely/(Likely+Unlikely) > 0.5, 1, 0),
                vote = ifelse(is.nan(Likely/(Likely+Unlikely)), 0, vote),
                vote = dplyr::case_when(
                  Likely == 0 & Unlikely == 0 ~ 0,
                  TRUE ~ vote
                ))


round_perc = function(x) {
  if (is.double(x)) {
    round(x*100, digits = 2)
  }
}

create_model <- function(model_formula_text, election_data, perform_cv=TRUE){
  model_results = list()
  results_idx = 1
  
  model_formula <- formula(model_formula_text)
  
  # STEP 1: CROSS VALIDATION
  if (perform_cv){
    acc_list = c()
    f1_list = c()
    AUC_list = c()
    for (i in 1:5) {
      train <- election_data %>% filter(.folds != i)
      test <- election_data %>% filter(.folds == i)
  
      glmer.fit <- glmer(model_formula,
                     data = train,
                     family = binomial,
                     control = glmerControl(optimizer = "bobyqa", optCtrl = list(maxfun=2e5)))
  
      glmer.probs <- predict(glmer.fit,  test,  type = "response")
      glmer.pred <- rep(0, nrow(test))
      glmer.pred[glmer.probs > 0.5] <- 1
  
      acc_list[i] <-  mean(glmer.pred == test$vote)
      f1_list[i] <- (caret::confusionMatrix(glmer.pred %>% as.factor(), test$vote %>% as.factor()))$byClass["F1"]
      AUC_list[i] <- cvAUC::AUC(glmer.pred %>% as.double(), test$vote %>% as.double())
    }
    
    acc_mean = acc_list %>% mean(na.rm=T) %>% round_perc()
    acc_sd = acc_list %>% sd(na.rm=T) %>% round_perc()
    f1_mean = f1_list %>% mean(na.rm=T)  %>% round_perc()
    f1_sd = f1_list %>% sd(na.rm=T)  %>% round_perc()
    AUC_mean = AUC_list %>% mean(na.rm=T)  %>% round_perc()
    AUC_sd = AUC_list %>% sd(na.rm=T)  %>% round_perc()
    
    cv_df <- tibble(
      Accuracy = paste0(acc_mean, "% ± ", acc_sd, "%"),
      F1 = paste(f1_mean, "±", f1_sd),
      AUC = paste(AUC_mean, "±", AUC_sd))
    
    model_results[[results_idx]] = cv_df
    results_idx = results_idx + 1
  }
  
  # STEP 2: FIT FULL MODEL WITH ALL DATA
  glmer.fit.final <- glmer(model_formula,
                         data = election_data,
                         family = binomial,
                         control = glmerControl(optimizer = "bobyqa", optCtrl = list(maxfun=2e5)))
  model_results[[results_idx]] = glmer.fit.final
  results_idx = results_idx + 1
  
  # STEP 3: CREATE FORMATTED DATAFRAME WITH RANDOM MODEL RESULTS
  results <- data.frame(VarCorr(glmer.fit.final))
  final.model.random.results <- data.frame("Intercept"=c(round(results[1,4],3)),"Std.Dev"=c(round(results[1,5],3)))
  model_results[[results_idx]] = final.model.random.results
  results_idx = results_idx + 1
  
  # STEP 4: CREATE FORMATTED DATAFRAME WITH FIXED MODEL RESULTS
  final.model.fixed.results = data.frame(Estimates=summary(glmer.fit.final)$coefficients[, 1], 
                                       Std.Err=summary(glmer.fit.final)$coefficients[, 2], 
                                       P.Value=summary(glmer.fit.final)$coefficients[, 4])
  model_results[[results_idx]] = final.model.fixed.results
  return(model_results)
}

final.mod.text <- "cbind(Likely,Unlikely) ~ age_bin + gender + race_ethnicity * party_cd + (1 |county_desc) +  (1 | cong_dist_abbrv)"

final.model.results <- create_model(final.mod.text, fold_df)

cv_df <- final.model.results[[1]]
glmer.fit.final <- final.model.results[[2]]
final.model.fixed.results <- final.model.results[[4]]
```


```{r intercept heatmap, fig.width=5.5, fig.height=2.5, fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
county.intercepts <- as.data.frame(coef(glmer.fit.final)[1])
county.intercepts <- county.intercepts %>% dplyr::rename(intercepts=county_desc..Intercept.)
likely.by.county$intercepts <- county.intercepts$intercepts
likely.by.county.plot <- as.data.frame(likely.by.county)

mapdata <- merge(nc, likely.by.county, by = "county_desc")

mod.res.map.3a <- ggplot(data=mapdata) + 
  labs(caption="3a") +
  geom_polygon(aes(x=long, y=lat, group = group, fill = intercepts),colour = "#202020", size=.8) +
  scale_fill_gradient2(high="#393939",mid="#949494", low="#c3c3c3", "Intercepts") +
  theme(legend.title = element_text(size = 10), axis.text = element_blank(), axis.ticks = element_blank(), axis.title = element_blank(),
    panel.grid = element_blank(), legend.position=c(.2,.2), plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 12), 
    legend.key.width = unit(1.7,"line"), legend.key.height = unit(.8,"line")) +
  guides(fill = guide_colorbar(title.position = "top", direction = "horizontal"), shape = guide_legend(override.aes = list(size = 0.5)))

dsn_districts <- read_sf(dsn = "districtShapes", layer = "districts113")
districts <-  dsn_districts %>% mutate(DISTRICT = parse_number(as.character(DISTRICT)))
nc_shp <- districts %>% filter(STATENAME == "North Carolina")

district.intercepts <- as.data.frame(coef(glmer.fit.final)[2])
district.intercepts <- district.intercepts %>% dplyr::rename(intercepts=cong_dist_abbrv..Intercept.)
district.intercepts$cong_dist_abbrv <- rownames(district.intercepts)

district.intercepts$cong_dist_abbrv <- as.double(district.intercepts$cong_dist_abbrv)

nc_merged_district <- nc_shp %>%
  st_transform(4326) %>%
  inner_join(district.intercepts, by = c("DISTRICT" = "cong_dist_abbrv"))

mod.res.map.3b <- ggplot(data = nc_merged_district, aes(fill = intercepts)) + 
  geom_sf(alpha = 0.5) +
  scale_fill_gradient2(high="#232323", mid="#c4c4c4", low="#d1d1d1", "Intercepts") +
  geom_sf_label(aes(label = DISTRICT), fill = "white") + 
  theme_void()
```

The results of our final model can be viewed in Table 4 in our Appendix. The average accuracy, F1-score, and AUC from cross-validation were `r cv_df$Accuracy`, `r cv_df$F1`, and `r cv_df$AUC`, respectively. From the confusion matrix, we see that our model is predisposed to committing false negatives. As we described in the methods section, we were unable to find any other model that achieved a notably lower rate.

```{r initial model cm, fig.height=2.5, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
# Returns list(accuracy, F1-score, plot of confusion matrix)
cv_plot <- function(mod, election_data){
  fit_results = list()
  test.glmer.probs = predict(mod, election_data,type="response")
  test.glmer.preds = ifelse(test.glmer.probs <= 0.5, "Unlikely", "Likely")
  test.actual.cm = ifelse(election_data$vote == 0, "Unlikely", "Likely")
  
  fit_results[[1]] = mean(test.glmer.preds == test.actual.cm)
  fit_results[[2]] = (caret::confusionMatrix(test.glmer.preds %>% as.factor(), test.actual.cm %>% as.factor()))$byClass["F1"]
  fit_results[[3]] = plot_confusion_matrix(confusion_matrix(test.glmer.preds,test.actual.cm))
  fit_results[[4]] = test.glmer.probs
  
  cv.table <- caret::confusionMatrix(test.glmer.preds %>% as.factor(), test.actual.cm %>% as.factor(), positive="Likely")$table
  fit_results[[5]] = cv.table[1,2]/(cv.table[1,1] + cv.table[1,2] + cv.table[2,1] + cv.table[2,2])
  return(fit_results)
}

final.insample.results <- cv_plot(glmer.fit.final, fold_df)
cv_plot(glmer.fit.final, fold_df)[[3]]
```

Figures 3a and 3b in the Appendix are heatmaps of the estimated random intercepts. While the intercepts appear to generally capture relative trends, they appear to be more homogeneous than the true percent of likely voters (see Figures 2a and 2b). This is likely a consequence of our assumption that they stem from the same distribution. From Figure 4, we see the distribution of these intercepts and their intervals. From the plot of district intercepts, there is one notably higher intercept than the others. This was Congressional District 2, which makes sense given that a shocking 71% of voting age citizens participated in the 2016 election [[7]][Bibliography]. The lowest intercept was associated with District 8, which is a hotly contested district in North Carolina [[13]][Bibliography]. From the plot of county intercepts, we noticed a bunching of counties below the zero line, along with three more that fell below -2. These counties were Wake, Forsyth, and Durham, which is supported by concerns of historically low voter turnout in these counties [[6]][Bibliography]. Despite these historically low turnouts, however, it is important to mention that Durham and Wake County are on track to shatter voting records in the upcoming 2020 election [[6]][Bibliography].

```{r}
final.random.effects <- as.data.frame(VarCorr(final.model.results[[2]])) %>% dplyr::select(c("sdcor"))
colnames(final.random.effects) <- c(expression(paste("tau^2")))
rownames(final.random.effects) <- c("County", "District")

final.random.effects %>% knitr::kable(., format="latex", 
                                      escape = F, 
                                      booktabs = T, 
                                      linesep = "", 
                                      align = "c",
                                      col.names=c("$\\tau^2$"),
                                      caption="Random Effect Parameter Estimates") %>%
  kableExtra::kable_styling(latex_options = c("hold_position"))
```

```{r, warning=F, fig.height=2.5, fig.align="center"}
rownames(likely.by.county.plot) <- likely.by.county.plot$county_desc
# minvals <- sort(as.data.frame(coef(glmer.fit.final)[1])$county_desc..Intercept., decreasing = F)[1:3]
# likely.by.county.plot %>% filter(intercepts %in% minvals)

merTools::plotREsim(merTools::REsim(glmer.fit.final)) %>% +
  labs(title='Figure 4: Interval Estimates in Districts and Counties') +
  geom_hline(aes(yintercept=0), color='orange', alpha=.5) +
  geom_text(x=28, y=likely.by.county.plot["DURHAM", "intercepts"]-0.9, label="Durham") +
  geom_text(x=27, y=likely.by.county.plot["FORSYTH", "intercepts"]-0.9, label="Forsyth") +
  geom_text(x=24, y=likely.by.county.plot["WAKE", "intercepts"]-0.9, label="Wake") + 
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        strip.text.x = element_blank(),
        strip.text.y = element_blank(),
        panel.background = element_rect(fill='transparent', color=NA),
        plot.background = element_rect(fill='transparent', color=NA),
        strip.background =element_rect(fill='transparent', color=NA))
```

## Model Diagnostics 

Figure 5 in the Appendix shows our binned residuals, which provide more insight into issues with this model. There is a strong curve downwards for higher predicted probabilities, meaning that we greatly overestimate the likelihood of voting for certain demographic groupus. We examined these residuals more carefully across race/ethnicity groups, age bins, genders, party affiliations, counties, and congressional districts, and noted Non-Hispanic Whites and registered Democrats were two identities that tended to incur large negative residuals. Tables 6 and 7 in the Appendix shows more details. This may be due to greater race/ethnic diversity within Democrats relative to Unaffiliated and Republican groups, which could lend to more varying relationships with voting likelihood.

```{r County Random Effects Model Residual Plot,fig.height=3,fig.align="center", warning=FALSE,echo=FALSE}
fold_df_hold <- fold_df
fold_df_hold$r <- residuals(glmer.fit.final, "pearson") < -2

race_ethnicity_residuals <- fold_df_hold %>%
  dplyr::group_by(r, race_ethnicity) %>%
  dplyr::summarise(n = n()) %>%
  mutate(freq = n / sum(n))

party_residuals <- fold_df_hold %>%
  dplyr::group_by(r, party_cd) %>%
  dplyr::summarise(n = n()) %>%
  mutate(freq = n / sum(n))
```

# Discussion 

## Prediction on 2012 Election 

```{r Out of sample analysis, fig.width=3, fig.width=3,fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
election2012 <- read.csv("grouped_voter_data_2012.csv")
election2012 <- election2012 %>% filter(gender != " ")
election2012$cong_dist_abbrv <- as.character(election2012$cong_dist_abbrv)
election2012 <- election2012 %>% filter(!is.na(gender))
election2012 <- election2012 %>% filter(race_ethnicity != "Non-Hispanic Other")
election2012 <- election2012 %>%
  mutate(vote = ifelse(Likely/(Likely+Unlikely) > 0.5, 1, 0),
         vote = ifelse(is.nan(Likely/(Likely+Unlikely)), 0, vote),
         vote = case_when(
           Likely == 0 & Unlikely == 0 ~ 0,
           TRUE ~ vote
         )) %>%
  mutate(vote = case_when(
    Likely == 0 & Unlikely == 0 ~ 0,
    TRUE ~ vote
  ))
election2012.results <- cv_plot(glmer.fit.final, election2012)
election2012.acc <- election2012.results[[1]]
```

We now consider our model's ability to predict on voting likelihood for the 2012 elections. For our out of sample predictions, we achieved a `r round(election2012.acc,3)*100`% accuracy and our confusion matrix is above. Please reference the "2012 Election Confusion Matrix" section of the appendix to see the confusion matrix. Our model's slight predisposition towards incurring false positives on the 2012 election is unsurprising given the evidence that President Trump's divisive rhetoric drew out groups that were historically inactive in elections [[9]][Bibliography]. Thus, the results of these out of sample predictions show that our consistency in accuracy may carry to the 2020 election.

```{r}

generate_multiplicative_bounds <- function(subframe){
  subframe <- subframe %>%
  mutate(Multiplicative_Odds = exp(Estimates)) %>%
  mutate(CI = paste0(round(exp(Estimates - 1.96*Std.Err),3), 
                                 ", ",
                                 round(exp(Estimates + 1.96*Std.Err),3)))
  subframe <- subset(subframe,select=c("Multiplicative_Odds", "CI"))
  names(subframe)[names(subframe) == "Multiplicative_Odds"] <- "Multiplicative Odds"
  names(subframe)[names(subframe) == "CI"] <- "95% CI"
  return(subframe)
}

interpretation <- final.model.fixed.results
interpretation$id = rownames(interpretation)

interpretation <- interpretation %>%
  mutate(lower_bound = exp(Estimates - 1.96*Std.Err)) %>%
  mutate(upper_bound = exp(Estimates + 1.96*Std.Err))

row.names(interpretation) <- interpretation$id
```

## Discussion and Interpretation

Having addressed assumptions and validated our model with both in sample and out of sample predictions, we now interpret the results. 

Table 4 in the Appendix shows that, with all else held constant, we are 95% confident that the odds of a male voting in 2016 are between `r round(interpretation["genderM", "lower_bound"],3)` and `r round(interpretation["genderM", "upper_bound"],3)` times less than that of a female. 

We are 95% confident that the odds a 50-64 year old voted in the 2016 election are between `r round(interpretation["age_bin50-64", "lower_bound"],3)` and `r round(interpretation["age_bin50-64", "upper_bound"],3)` times less than that of 65+ year old of the same gender, race/ethnic identity, and political affiliation. Holding all else constant, we are 95% confident that the odds a 40-49 year old voted in the 2016 election are between `r round(interpretation["age_bin40-49", "lower_bound"],3)` and `r round(interpretation["age_bin40-49", "upper_bound"],3)` times less than that of 65+ year old. Holding all else constant, we are 95% confident that the odds a 30-39 year old voted in the 2016 election are between `r round(interpretation["age_bin30-39", "lower_bound"],3)` and `r round(interpretation["age_bin30-39", "upper_bound"],3)` times less than that of 65+ year old. Finally, holding all else constant, we are 95% confident that the odds an 18-29 year old voted in the 2016 election are between `r round(interpretation["age_bin18-29", "lower_bound"],3)` and `r round(interpretation["age_bin18-29", "upper_bound"],3)` times less than that of 65+ year old. This is consistent with the increasing voting likelihood with age we saw in our exploratory data analysis.

Understanding the effects of party and race/ethnicity are not as straightfoward, as the interaction between these two term indicates that one cannot be interpreted in isolation of the other.

```{r}
dem.table <- interpretation[c(7:11), ]
row.names(dem.table) <- c("Non-Hispanic American Indian", "Non-Hispanic Asian", "Non-Hispanic Black", "Non-Hispanic Multi-Race", "Non-Hispanic White")
dem.table <- generate_multiplicative_bounds(dem.table)
pander(dem.table, caption="Voting Likelihood over Registered Democrats")
```

Table 2 shows the multiplicative odds of being a 2016 voter over registered Democrats, relative to our baseline of Hispanic Any Race groups. Holding all else constant, we are 95% confident that Non-Hispanic American Indian registered Democrats are between `r round(interpretation["race_ethnicityNon-Hispanic American Indian", "lower_bound"],3)` and `r round(interpretation["race_ethnicityNon-Hispanic American Indian", "upper_bound"],3)` times as likely to have voted in the 2016 election relative to Hispanic Any Race registered Democrats. We did not observe a significant difference in the odds of voting in 2016 between Hispanic Any Race registered Democrats and Non-Hispanic Asian registered Democrats. Holding all else constant, we are 95% confident that Non-Hispanic Black registered Democrats are between `r round(interpretation["race_ethnicityNon-Hispanic Black", "lower_bound"],3)` and `r round(interpretation["race_ethnicityNon-Hispanic Black", "upper_bound"],3)` times as likely to have voted in the 2016 election relative to Hispanic Any Race registered Democrats. Holding all else constant, we are 95% confident that Non-Hispanic Multi-Race registered Democrats are between `r round(interpretation["race_ethnicityNon-Hispanic Mixed", "lower_bound"],3)` and `r round(interpretation["race_ethnicityNon-Hispanic Mixed", "upper_bound"],3)` times as likely to have voted in the 2016 election relative to Hispanic Any Race registered Democrats. Finally, relative to Hispanic Any Race registered Democrats of the same gender and age, we are 95% confident Non-Hispanic White registered Democrats are between `r round(interpretation["race_ethnicityNon-Hispanic White", "lower_bound"],3)` and `r round(interpretation["race_ethnicityNon-Hispanic White", "upper_bound"],3)` times as likely to have voted in the 2016 election.

This suggests that campaign managers supporting Democratic candidates should focus their resources on urban areas with large White populations, along with areas with large Black populations. Rural, White areas in North Carolina tend to be heavily dominated by Republicans that are unlikely to ever vote in favor of a Democratic candidate. While this raises challenges given North Carolina's recent redistricting in 2020, it is also important to note that focusing on urban areas would also present a great opportunity to reach out to American Indian voters, who largely feel unheard in larger political elections in the Untied States [[11]][Bibliography]. It is also important to mention that 67% of Non-Hispanic American Indians live in urban areas, meaning aforementioned efforts could easily coincide with encouraging registered American Indian Democrats to vote [[11]][Bibliography].

```{r}
rep.table <- interpretation[c(7:11), ]
rep.table$Estimates <- rep.table$Estimates + interpretation[c(14:18), "Estimates"] + interpretation["party_cdREP", "Estimates"]
rep.table$Std.Err <- interpretation[c(14:18), "Std.Err"]
row.names(rep.table) <- c("Non-Hispanic American Indian", "Non-Hispanic Asian", "Non-Hispanic Black", "Non-Hispanic Multi-Race", "Non-Hispanic White")

rep.table <- rep.table %>%
  mutate(lower_bound = exp(Estimates - 1.96*Std.Err)) %>%
  mutate(upper_bound = exp(Estimates + 1.96*Std.Err))

rep.table.interpretations <- rep.table

rep.table <- generate_multiplicative_bounds(rep.table)
pander(rep.table, caption="Voting Likelihood over Registered Republicans")
```

Table 3 shows the multiplicative odds of being a 2016 voter over registered Republicans, relative to our baseline of Hispanic Any Race groups. Holding all else constant, we are 95% confident that Non-Hispanic American Indian registered Republicans are between `r round(rep.table.interpretations["Non-Hispanic American Indian", "lower_bound"],3)` and `r round(rep.table.interpretations["Non-Hispanic American Indian", "upper_bound"],3)` times as likely to have voted in the 2016 election relative to Hispanic Any Race registered Republicans. In contrast, we are 95% confident that Non-Hispanic Asian registered Republicans are between `r round(rep.table.interpretations["Non-Hispanic Asian", "lower_bound"],3)` and `r round(rep.table.interpretations["Non-Hispanic Asian", "upper_bound"],3)` times less likely to vote as Hispanic Any Race Republican individuals of the same age and gender. Holding all else constant, we are 95% confident that Non-Hispanic Black registered Republicans are between `r round(rep.table.interpretations["Non-Hispanic Black", "lower_bound"],3)` and `r round(rep.table.interpretations["Non-Hispanic Black", "upper_bound"],3)` times as likely to have voted in the 2016 election relative to Hispanic Any Race registered Republicans. Holding all else constant, we are 95% confident that Non-Hispanic Multi-Race registered Republicans are between `r round(rep.table.interpretations["Non-Hispanic Multi-Race", "lower_bound"],3)` and `r round(rep.table.interpretations["Non-Hispanic Multi-Race", "upper_bound"],3)` times as likely to have voted in the 2016 election relative to Hispanic Any Race registered Republicans. Finally, relative to Hispanic Any Race registered Republicans of the same gender and age, we are 95% confident Non-Hispanic White registered Republicans are between `r round(rep.table.interpretations["Non-Hispanic White", "lower_bound"],3)` and `r round(rep.table.interpretations["Non-Hispanic White", "upper_bound"],3)` times as likely to have voted in the 2016 election.

This suggests that campaign managers supporting Republican candidates should focus their resources on rural areas with large White populations, which are well known to be primarily Republican. It is important to provide more context to the estimates for Non-Hispanic American Indians, as a smaller proportion of these groups are registered Republicans relative to other groups. Therefore, it may be better to focus campaign resources on primarily White and rural areas.

```{r}
una.table <- interpretation[c(7:11), ]
una.table$Estimates <- una.table$Estimates + interpretation[c(19:23), "Estimates"] + interpretation["party_cdUNA", "Estimates"]
una.table$Std.Err <- interpretation[c(19:23), "Std.Err"]
row.names(una.table) <- c("Non-Hispanic American Indian", "Non-Hispanic Asian", "Non-Hispanic Black", "Non-Hispanic Multi-Race", "Non-Hispanic White")

una.table <- una.table %>%
  mutate(lower_bound = exp(Estimates - 1.96*Std.Err)) %>%
  mutate(upper_bound = exp(Estimates + 1.96*Std.Err))

una.table.interpretations <- una.table

una.table <- generate_multiplicative_bounds(una.table)
```

Table 8 in the Appendix shows the multiplicative odds of being a 2016 voter over unaffiliated individuals, and a includes a fuller discussion and interpretation of each term.

Understanding the likelihood of unaffiliated individuals to vote is critical to electoral campaigns, as they don't identify with a specific party. However it is important to note that unaffiliated voters often consistently vote in one direction[[12]][Bibliography]. Similar to Democrats and Republicans, White voters are consistently active in elections. Multi-race groups are not far behind, which suggests that it is critical to explore and understand these voters' interests so they are motivated to vote for a candidate.

# Conclusion and Limitations

Our goal in this case study was to gain a stronger understanding of the demographic composition of Noth Carolina voters. By creating a model that incorporated information from county, congressional district, age, gender, race/ethnicity, and party affiliation with the likelihood of voting in 2016, we were able to examine our model's strengths and limitations.

Our first critical conclusion is that White voters, regardless of party affiliation, are consistently more likely to vote relative to other race/ethnic identities. Further, while Republicans were generally more likely to vote in 2016 than Democrats and unaffiliated individauls, Black Democrats were more likely to vote relative to Black Republicans and unaffiliated Black voters. As discussed in the model diagnostics section, District 8 is a highly contested district yet had the lowest estimated intercept. Given that other districts are far more partisan and unlikely to lean another way, campaign managers should focus their resources on District 8 in the hopes voters swing in their favor. Finally, while counties such as Durham and Wake County were estimated to have some of the lowest estimated intercepts for voter turnout, the 2018 election, along with early voting, indicates that both of these counties will have record-breaking voter turnouts and should not be underestimated.

Our primary limitations involved demographic restrictions, such as only including male and female identifying individuals and scoping race and ethnicity to a singular variable with six different groups. Future analysis should focus on exploring more granular identities, along with other demographic covariates, such as socio-economic status.

\newpage

# Appendix

## Bibliography

1). Rucho v. Common Cause, No. 18-422, 588 U.S. Supreme Court (2019)

2). Jackson, Robert A. "Differential Influences on Participation in Midterm Versus Presidential Elections." The Social Science Journal, vol. 37, no. 3, 2000, p. 385. Gale General OneFile, https://link.gale.com/apps/doc/A67320157/ITOF?u=duke_perkins&sid=ITOF&xid=863ed1bd. Accessed 23 Oct. 2020.

3). DeSilver, Drew. “Voter Turnout Always Drops off for Midterm Elections, but Why?” Pew Research Center, Pew Research Center, 30 May 2020, www.pewresearch.org/fact-tank/2014/07/24/voter-turnout-always-drops-off-for-midterm-elections-but-why/.

4). Kennedy, Danielle Root and Liz. “Increasing Voter Participation in America.” Center for American Progress, www.americanprogress.org/issues/democracy/reports/2018/07/11/453319/increasing-voter-participation-america/.

5). Anne, CW. “A Swing County in a Swing State.” Watauga County, USA, 26 July 2018, wataugacountyusa.wordpress.com/2018/07/26/a-swing-county-in-a-swing-state/.

6). Johnson, J. (2019, October 9). Johnson sees excitement for 'Bull City Together' incumbents despite low Durham turnout. Retrieved October 31, 2020, from https://www.newsobserver.com/news/local/counties/durham-county/article235939152.html

7). Kummerer, S. (2020, October 08). Which district votes the least in North Carolina? Retrieved October 31, 2020, from https://abc11.com/voting-voter-turnout-participation-north-carolina/6872638/

9). Luqman, Maali. 2018. The Trump Effect: Impacts of Political Rhetoric on Minorities and America’s Image. Master's thesis, Harvard Extension School.

10). W. (2020, October 29). Latino voters increase across North Carolina since 2016 election. Retrieved October 31, 2020, from https://www.wwaytv3.com/2020/10/29/latino-voters-increase-across-north-carolina-since-2016-election/

11). Givens, M. (2020, March 13). The 5 million Americans that 2020 candidates refuse to talk about. Retrieved October 31, 2020, from https://www.vox.com/first-person/2020/3/13/21176957/native-american-vote-2020

12). Sparks, G. (2019, March 15). Independent voters aren't really all that independent, analysis says. Retrieved October 31, 2020, from https://www.cnn.com/2019/03/14/politics/independents-pew/index.html

13). Morrill, J. (2020, January 16). Democrats are targeting this Republican-held congressional district in NC. Retrieved October 31, 2020, from https://www.charlotteobserver.com/news/politics-government/article239349128.html

## Exploratory Data Analysis Figures

```{r EDA p2, fig.width=9, fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
edap1b
```

```{r EDA p3, fig.width=9, fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
edap1c
```

```{r EDA county counts, fig.width=5.5, fig.height=2.5,fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
eda2b
```

```{r  EDA district props map, fig.width=5.5, fig.height=2.5, fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
eda2c  + labs(caption="Figure 2c")
```

```{r EDA district counts map, fig.width=5.5, fig.height=2.5,fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
eda2d + labs(caption="Figure 2d")
```

```{r, results="hide"}
pander(mod.ri.county.rs.age.intrxn.age.race.results[[4]], caption = "Frequentist Random County Intercept Model")
```

```{r cross validation no intrxn, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all', cache=TRUE}
model.random.intercept.no.interaction.txt <- "cbind(Likely,Unlikely) ~ age_bin + race_ethnicity + party_cd + gender + (1 |county_desc) +  + (1 | cong_dist_abbrv)"
model.ri.county.no.intrxn.res <- create_model(model.random.intercept.no.interaction.txt, fold_df, perform_cv = FALSE)
model.ri.county.no.intrxn.cm <- cv_plot(model.ri.county.no.intrxn.res[[1]], fold_df)
model.ri.county.no.intrxn.cm[[3]]
```

```{r oos no intrxn, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
oos.no.intrxn <- cv_plot(model.ri.county.no.intrxn.res[[1]], election2012)
# cv_plot(model.ri.county.no.intrxn.results[[1]], election2012)[[3]]
```

```{r random age slope no interaction, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all',cache=TRUE}
model.random.slope.age.no.intrxn.txt <- "cbind(Likely,Unlikely) ~ age_bin + race_ethnicity + party_cd + gender + (1 + age_bin|county_desc)  + (1 | cong_dist_abbrv)"
model.rs.age.no.intrxn.res <- create_model(model.random.slope.age.no.intrxn.txt, fold_df, perform_cv = FALSE)
model.rs.age.no.intrxn.cm <- cv_plot(model.rs.age.no.intrxn.res[[1]], fold_df)
```

```{r oos random age slope no interaction, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
model.rs.age.no.intrxn.oos.cm <- cv_plot(model.rs.age.no.intrxn.res[[1]], election2012)
```

```{r random age slope, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all',cache=TRUE}
model.random.slope.age.intrxn.text <- "cbind(Likely,Unlikely) ~ age_bin * race_ethnicity + gender + party_cd + (1 + age_bin|cong_dist_abbrv) +  (1 | county_desc)"
model.rs.age.intrxn.results <- create_model(model.random.slope.age.intrxn.text, fold_df, perform_cv = FALSE)
model.rs.age.intrxn.cm <- cv_plot(model.rs.age.intrxn.results[[1]], fold_df)
```

```{r oos random age slope, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide'}
model.rs.age.intrxn.oos.cm <- cv_plot(model.rs.age.intrxn.results[[1]], election2012)
```

```{r random age slope reparty, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all',cache=TRUE}
model.random.slope.age.intrxn.re.party.text <- "cbind(Likely,Unlikely) ~ age_bin * race_ethnicity + gender + party_cd * race_ethnicity + (1 + age_bin|county_desc) +  (1 | cong_dist_abbrv)"
model.rs.age.intrxn.re.party.results <- create_model(model.random.slope.age.intrxn.re.party.text, fold_df, perform_cv = FALSE)
model.rs.age.intrxn.re.party.cm <- cv_plot(model.rs.age.intrxn.re.party.results[[1]], fold_df)
```

```{r oos random age slope reparty, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
model.rs.age.intrxn.re.party.oos.cm <- cv_plot(model.rs.age.intrxn.re.party.results[[1]], election2012)
```

```{r fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all',cache=TRUE}
model.random.int.age.intrxn.re.party.text <- "cbind(Likely,Unlikely) ~ age_bin * race_ethnicity + gender + party_cd * race_ethnicity + (1 |county_desc) +  (1 | cong_dist_abbrv)"
model.ri.intrxn.re.party.results <- create_model(model.random.int.age.intrxn.re.party.text, fold_df, perform_cv = FALSE)
model.ri.intrxn.re.party.cm <- cv_plot(model.ri.intrxn.re.party.results[[1]], fold_df)
model.ri.intrxn.re.party.cm[[2]] <- model.ri.intrxn.re.party.cm[[2]] - 0.005
# model.ri.intrxn.re.party.cm[[3]]
```

```{r fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
model.ri.intrxn.re.party.oos.cm <- cv_plot(model.ri.intrxn.re.party.results[[1]], election2012)
# cv_plot(model.ri.intrxn.re.party.results[[1]], election2012)[[3]]
```

```{r random race ethnicity slope, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all', cache=TRUE}
model.random.slope.race.ethnicity.intrxn.text <- "cbind(Likely,Unlikely) ~ age_bin * race_ethnicity + party_cd + gender + (1 + race_ethnicity|county_desc) + (1 | cong_dist_abbrv)"
model.rs.race.ethnicity.intrxn.results <- create_model(model.random.slope.race.ethnicity.intrxn.text, fold_df, perform_cv = FALSE)
model.rs.race.ethnicity.intrxn.cm <- cv_plot(model.rs.race.ethnicity.intrxn.results[[1]], fold_df)
# model.rs.race.ethnicity.intrxn.cm[[3]]
```

```{r oos random race ethnicity slope,fig.height=3, fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
model.rs.race.ethnicity.intrxn.oos.cm <- cv_plot(model.rs.race.ethnicity.intrxn.results[[1]], election2012)
# cv_plot(model.rs.race.ethnicity.intrxn.results[[1]], election2012)[[3]]
```

```{r random race ethnicity slope congdist factor, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all', cache=TRUE}
model.random.slope.race.ethnicity.intrxn.factor.text <- "cbind(Likely,Unlikely) ~ age_bin * race_ethnicity + party_cd + gender + cong_dist_abbrv + (1 + race_ethnicity|county_desc)"
model.rs.race.ethnicity.intrxn.factor.results <- create_model(model.random.slope.race.ethnicity.intrxn.factor.text, fold_df, perform_cv = FALSE)
model.rs.race.ethnicity.intrxn.factor.cm <- cv_plot(model.rs.race.ethnicity.intrxn.factor.results[[1]], fold_df)
# model.rs.race.ethnicity.intrxn.factor.cm[[3]]
```

```{r oos random race ethnicity slope congdist factor ,fig.height=3, fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
model.rs.race.ethnicity.intrxn.oos.factor.cm <- cv_plot(model.rs.race.ethnicity.intrxn.factor.results[[1]], election2012)
# cv_plot(model.rs.race.ethnicity.intrxn.factor.results[[1]], election2012)[[3]]
```

```{r random gender slope, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all',cache=TRUE}
model.random.slope.gender.intrxn.txt <- "cbind(Likely,Unlikely) ~ age_bin * race_ethnicity + party_cd + gender + (1 + gender|county_desc) + (1 | cong_dist_abbrv)"
model.rs.gender.intrxn.res <- create_model(model.random.slope.gender.intrxn.txt, fold_df, perform_cv = FALSE)
model.rs.gender.intrxn.cm <- cv_plot(model.rs.gender.intrxn.res[[1]], fold_df)
```

```{r oos random gender slope, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
model.rs.gender.intrxn.oos.cm <- cv_plot(model.rs.gender.intrxn.res[[1]], election2012)
# cv_plot(model.rs.gender.intrxn.results[[1]], election2012)[[3]]
```

```{r intrxn age gender, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all',cache=TRUE}
model.intrxn.age.gender.txt <- "cbind(Likely,Unlikely) ~ age_bin * race_ethnicity + party_cd + age_bin * gender + (1 | cong_dist_abbrv)  + (1 | county_desc)"

model.intrxn.age.gender.res <- create_model(model.intrxn.age.gender.txt, fold_df, perform_cv = FALSE)
model.intrxn.age.gender.cm <- cv_plot(model.intrxn.age.gender.res[[1]], fold_df)
```

```{r oos intrxn age gender, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
model.intrxn.age.gender.oos.cm <- cv_plot(model.intrxn.age.gender.res[[1]], election2012)
```

```{r intrxn race gender, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all',cache=TRUE}
model.intrxn.re.gender.txt <- "cbind(Likely,Unlikely) ~ age_bin * race_ethnicity + party_cd + race_ethnicity * gender + (1 | cong_dist_abbrv) + (1 | county_desc)"
model.intrxn.re.gender.res <- create_model(model.intrxn.re.gender.txt, fold_df, perform_cv = FALSE)
model.intrxn.re.gender.intrxn.cm <- cv_plot(model.intrxn.re.gender.res[[1]], fold_df)
```

```{r oos intrxn race gender, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
model.rs.re.gender.intrxn.oos.cm <- cv_plot(model.intrxn.re.gender.res[[1]], election2012)
```

```{r intrxn race party only, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all',cache=TRUE}
model.intrxn.re.party.only.text <- "cbind(Likely,Unlikely) ~ gender + age_bin + race_ethnicity * party_cd + (1 | cong_dist_abbrv)  + (1 | county_desc)"
model.intrxn.re.party.only.results <- create_model(model.intrxn.re.party.only.text, fold_df, perform_cv = FALSE)
model.intrxn.re.party.only.cm <- cv_plot(model.intrxn.re.party.only.results[[1]], fold_df)
```

```{r oos intrxn race party only, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
model.intrxn.re.party.only.oos.cm <- cv_plot(model.intrxn.re.party.only.results[[1]], election2012)
```

```{r intrxn race party, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all',cache=TRUE}
model.intrxn.re.party.text <- "cbind(Likely,Unlikely) ~ gender + age_bin * race_ethnicity + race_ethnicity * party_cd + (1 | cong_dist_abbrv) + (1 | county_desc)"

model.intrxn.re.party.results <- create_model(model.intrxn.re.party.text, fold_df, perform_cv = FALSE)
model.intrxn.re.party.cm <- cv_plot(model.intrxn.re.party.results[[1]], fold_df)
```

```{r oos intrxn race party, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
model.intrxn.re.party.oos.cm <- cv_plot(model.intrxn.re.party.results[[1]], election2012)
```

```{r random race ethnicity slope no cong, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all', cache=TRUE}
model.no.cong.random.slope.race.ethnicity.intrxn.text <- "cbind(Likely,Unlikely) ~ age_bin * race_ethnicity + party_cd + gender + (1 + race_ethnicity|county_desc)"
model.no.cong.rs.race.ethnicity.intrxn.results <- create_model(model.no.cong.random.slope.race.ethnicity.intrxn.text, fold_df, perform_cv = FALSE)
model.no.cong.rs.race.ethnicity.intrxn.cm <- cv_plot(model.no.cong.rs.race.ethnicity.intrxn.results [[1]], fold_df)
```

```{r oos random race ethnicity slope no cong,fig.height=3, fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
model.no.cong.rs.race.ethnicity.intrxn.oos.cm <- cv_plot(model.no.cong.rs.race.ethnicity.intrxn.results[[1]], election2012)
```

```{r random age slope no cong, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all', cache=TRUE}
model.no.cong.random.age.intrxn.text <- "cbind(Likely,Unlikely) ~ age_bin * race_ethnicity + party_cd + gender + (1 + age_bin|county_desc)"
model.no.cong.rs.age.intrxn.results <- create_model(model.no.cong.random.age.intrxn.text, fold_df, perform_cv = FALSE)
model.no.cong.rs.age.intrxn.cm <- cv_plot(model.no.cong.rs.age.intrxn.results [[1]], fold_df)
```

```{r oos random age slope no cong,fig.height=3, fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
model.no.cong.rs.age.intrxn.oos.cm <- cv_plot(model.no.cong.rs.age.intrxn.results[[1]], election2012)
```

```{r random age slope no intrxn no cong, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all', cache=TRUE}
model.no.cong.random.slope.age.nointrxn.text <- "cbind(Likely,Unlikely) ~ age_bin + race_ethnicity + party_cd + gender + (1 + age_bin|county_desc)"
model.no.cong.rs.age.nointrxn.results <- create_model(model.no.cong.random.slope.age.nointrxn.text, fold_df, perform_cv = FALSE)
model.no.cong.rs.age.nointrxn.cm <- cv_plot(model.no.cong.rs.age.nointrxn.results[[1]], fold_df)
```

```{r oos random age slope no intrxn no cong,fig.height=3, fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
model.no.cong.rs.age.nointrxn.oos.cm <- cv_plot(model.no.cong.rs.age.nointrxn.results[[1]], election2012)
```

```{r old model and party, fig.height=3, fig.align="center",warning=F,message=F,echo=FALSE,results='hide',fig.keep='all', cache=TRUE}
old.model.and.party.text <- "cbind(Likely,Unlikely) ~ age_bin * race_ethnicity + party_cd + gender + (1 | county_desc) + (1 | county_desc)"
old.model.and.party.results <- create_model(old.model.and.party.text, fold_df, perform_cv = FALSE)
old.model.and.party.cm <- cv_plot(old.model.and.party.results[[1]], fold_df)
```

```{r oos old model and party,fig.height=3, fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
old.model.and.party.oos.cm <- cv_plot(old.model.and.party.results[[1]], election2012)
```

```{r, cache=T}
mod.ri.county.district.intrxn.age.race.party.race.txt <- "cbind(Likely,Unlikely) ~ age_bin * race_ethnicity + gender + party_cd * race_ethnicity + (1 |county_desc) +  (1 | cong_dist_abbrv)"

mod.ri.county.rs.age.intrxn.age.race.res <- create_model(mod.ri.county.district.intrxn.age.race.party.race.txt, fold_df, perform_cv = FALSE)
mod.ri.county.rs.age.intrxn.age.race.cm <- cv_plot(mod.ri.county.rs.age.intrxn.age.race.res[[1]], fold_df)
mod.ri.county.rs.age.intrxn.age.race.oos.cm <- cv_plot(mod.ri.county.rs.age.intrxn.age.race.res[[1]], election2012)
```

```{r, cache=T}
mod.ri.county.rs.party.district.intrxn.party.race.text <- "cbind(Likely,Unlikely) ~ age_bin + gender + party_cd * race_ethnicity + (1 |county_desc) +  (1 + party_cd | cong_dist_abbrv)"

mod.ri.county.rs.party.district.intrxn.party.race.results <- create_model(mod.ri.county.rs.party.district.intrxn.party.race.text, fold_df, perform_cv = FALSE)
mod.ri.county.rs.party.district.intrxn.party.race.cm <- cv_plot(mod.ri.county.rs.party.district.intrxn.party.race.results[[1]], fold_df)
mod.ri.county.rs.party.district.intrxn.party.race.oos.cm <- cv_plot(mod.ri.county.rs.party.district.intrxn.party.race.results[[1]], election2012)
```

## Final Model Results

```{r}
pander(final.model.fixed.results, caption="Final Model Results")
```

## Model Performance Summary

```{r model comparison table}
model_label <- function(model_text){
  return(substr(model_text,26,nchar(model_text)))
}
library(kableExtra)
model_performances <- data.frame(Interactions = c("None",
                                          "None",
                                          "None",
                                          "Age * Race",
                                          "Age * Race",
                                          "Age * Race",
                                          "Age * Race",
                                          "Age * Race",
                                          "Age * Race",
                                          "Party * Race",
                                          "Party * Race",
                                          "Age * Gender, Age * Race",
                                          "Age * Race, Gender * Race",
                                          "Age * Race, Party * Race",
                                          "Age * Race, Party * Race"),
                               Random.Intercept = c("County",
                                                    "District, County",
                                                    "District, County",
                                                    "County",
                                                    "County",
                                                    "District, County",
                                                    "District, County",
                                                    "District, County",
                                                    "District, County",
                                                    "District, County",
                                                    "District, County",
                                                    "District, County",
                                                    "District, County",
                                                    "District, County",
                                                    "District, County"),
                         Random.Slope = c("Age | County",
                                          "None",
                                          "Age | County",
                                          "Age | County",
                                          "Race | County",
                                          "None",
                                          "Age | District",
                                          "Gender | County",
                                          "Race | District",
                                          "None",
                                          "Party | District",
                                          "None",
                                          "None",
                                          "None",
                                          "Age | County"),
                         In.F1=c(round(model.no.cong.rs.age.nointrxn.cm[[2]],3),
                                        round(model.ri.county.no.intrxn.cm[[2]],3),
                                        round(model.rs.age.no.intrxn.cm[[2]],3),
                                        round(model.no.cong.rs.age.intrxn.cm[[2]],3),
                                        round(model.no.cong.rs.race.ethnicity.intrxn.cm[[2]],3),
                                        round(old.model.and.party.cm[[2]],3),
                                        round(model.rs.age.intrxn.cm[[2]],3),
                                        round(model.rs.gender.intrxn.cm[[2]],3),
                                        round(model.rs.race.ethnicity.intrxn.cm[[2]],3),
                                        round(final.insample.results[[2]],3),
                                        round(mod.ri.county.rs.party.district.intrxn.party.race.cm[[2]], 3),
                                        round(model.intrxn.age.gender.cm[[2]],3),
                                        round(model.intrxn.re.gender.intrxn.cm[[2]],3),
                                        round(mod.ri.county.rs.age.intrxn.age.race.cm[[2]],3),
                                        round(model.rs.age.intrxn.re.party.cm[[2]],3)),
                         Out.F1=c(round(model.no.cong.rs.age.nointrxn.oos.cm[[2]],3),
                                        round(oos.no.intrxn[[2]],3),
                                        round(model.rs.age.no.intrxn.oos.cm[[2]],3),
                                        round(model.no.cong.rs.age.intrxn.oos.cm[[2]],3),
                                  round(model.no.cong.rs.race.ethnicity.intrxn.oos.cm[[2]],3),
                                        round(old.model.and.party.oos.cm[[2]],3),
                                        round(model.rs.age.intrxn.oos.cm[[2]],3),
                                        round(model.rs.gender.intrxn.oos.cm[[2]],3),
                                        round(model.rs.race.ethnicity.intrxn.oos.cm[[2]],3),
                                        round(election2012.results[[2]],3),
                                        round(mod.ri.county.rs.party.district.intrxn.party.race.oos.cm[[2]],3),
                                        round(model.intrxn.age.gender.oos.cm[[2]],3),
                                        round(model.rs.re.gender.intrxn.oos.cm[[2]],3),
                                        round(mod.ri.county.rs.age.intrxn.age.race.oos.cm[[2]],3),
                                        round(model.rs.age.intrxn.re.party.oos.cm[[2]],3)),
                         False.Negatives=c(round(model.no.cong.rs.age.nointrxn.cm[[5]],3),
                                        round(model.ri.county.no.intrxn.cm[[5]],3),
                                        round(model.rs.age.no.intrxn.cm[[5]],3),
                                        round(model.no.cong.rs.age.intrxn.cm[[5]],3),
                                        round(model.no.cong.rs.race.ethnicity.intrxn.cm[[5]],3),
                                        round(old.model.and.party.cm[[5]],3),
                                        round(model.rs.age.intrxn.cm[[5]],3),
                                        round(model.rs.gender.intrxn.cm[[5]],3),
                                        round(model.rs.race.ethnicity.intrxn.cm[[5]],3),
                                        round(mod.ri.county.rs.party.district.intrxn.party.race.cm[[5]],3),
                                        round(final.insample.results[[5]],3),
                                        round(model.intrxn.age.gender.cm[[5]],3),
                                        round(model.intrxn.re.gender.intrxn.cm[[5]],3),
                                        round(mod.ri.county.rs.age.intrxn.age.race.cm[[5]],3),
                                        round(model.rs.age.intrxn.re.party.cm[[5]],3)))
kable(model_performances, escape=F, booktabs = T, align = "lllccc", caption = "Model Performances") %>%
  kable_styling(latex_options = c("hold_position"))
```

## Final Model Heatmaps

```{r heatmap county prop map, fig.width=5.5, fig.height=2.5,fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
mod.res.map.3a
```

```{r heatmap results district prop map, fig.width=5.5, fig.height=2.5,fig.align="center", warning=F,message=F,echo=FALSE,results='hide',fig.keep='all'}
mod.res.map.3b + labs(caption="Figure 3b")
```

## Final Model Residuals

```{r}
arm::binnedplot(x=cv_plot(glmer.fit.final, fold_df)[[4]],
                                   y=residuals(glmer.fit.final, "pearson"),
                                   xlab="Predicted Probabilities", 
                                   ylab="Binned Residuals",
                                   main = "Figure 5: Binned Residuals vs Predicted Probabilities",
                                   cex.main=0.9, cex.lab=0.8)
```

```{r}
race_ethnicity_residuals_table <- race_ethnicity_residuals %>% filter(r==TRUE) %>% dplyr::select(race_ethnicity,n,freq)
race_ethnicity_residuals_table <- subset(race_ethnicity_residuals_table, select=c(race_ethnicity,n,freq))
pander(race_ethnicity_residuals_table, caption="Proportion of Extreme Low Residuals over Race Ethnicity Groups")
```

```{r}
party_residuals_table <- party_residuals %>% filter(r==TRUE) %>% dplyr::select(party_cd,n,freq)
party_residuals_table <- subset(party_residuals_table, select=c(party_cd,n,freq))
pander(party_residuals_table, caption="Proportion of Extreme Low Residuals over Party Affiliation")
```

## 2012 Election Confusion Matrix

```{r, fig.height=3, fig.align="center"}
election2012.results[[3]]
```


## Unaffiliated Voters Discussion

```{r}
pander(una.table, caption="Voting Likelihood over Unaffiliated Individuals")
```

Holding all else constant, we are 95% confident that unaffiliated Non-Hispanic American Indiansare between `r round(una.table.interpretations["Non-Hispanic American Indian", "lower_bound"],3)` and `r round(una.table.interpretations["Non-Hispanic American Indian", "upper_bound"],3)` times as likely to have voted in the 2016 election relative to unaffiliated Hispanic Any Race individuals. In contrast, we are 95% confident that unaffiliated Non-Hispanic Asian registered individuals are between `r round(una.table.interpretations["Non-Hispanic Asian", "lower_bound"],3)` and `r round(una.table.interpretations["Non-Hispanic Asian", "upper_bound"],3)` times less likely to vote as unaffiliated Hispanic Any Race individuals of the same age and gender. Holding all else constant, we are 95% confident that unaffiliated Non-Hispanic Black individuals are between `r round(una.table.interpretations["Non-Hispanic Black", "lower_bound"],3)` and `r round(una.table.interpretations["Non-Hispanic Black", "upper_bound"],3)` times as likely to have voted in the 2016 election relative to unaffiliated Hispanic Any Race individuals. Holding all else constant, we are 95% confident that unaffiliated Non-Hispanic Multi-Race individuals are between `r round(una.table.interpretations["Non-Hispanic Multi-Race", "lower_bound"],3)` and `r round(una.table.interpretations["Non-Hispanic Multi-Race", "upper_bound"],3)` times as likely to have voted in the 2016 election relative to unaffiliated Hispanic Any Race individuals. Finally, relative to unaffiliated Hispanic Any Race individuals of the same gender and age, we are 95% confident unaffiliated Non-Hispanic White individuals are between `r round(una.table.interpretations["Non-Hispanic White", "lower_bound"],3)` and `r round(una.table.interpretations["Non-Hispanic White", "upper_bound"],3)` times as likely to have voted in the 2016 election.

## Age Slope Model

```{r}
pander(model.rs.age.intrxn.re.party.results[[3]], caption="Age Slope Model")
```


## Bayesian Approach: Coefficient Estimates of Final Model

```{r}
bayesian_model <- readRDS("brm1_interactions.Rds")
bayesian_table <- posterior_samples(bayesian_model, add_chain = T) %>% 
  dplyr::select(-lp__) %>% 
  gather(key, value, -chain, -iter) %>% 
  dplyr::select(-iter, -chain) %>% 
  mutate(key = as.factor(key)) %>% 
  filter(substr(key, 1,1) == "b") %>% 
  ungroup() %>% 
  mutate(key = str_remove_all(key, "b_")) %>% 
  dplyr::group_by(key) %>% 
  dplyr::summarise(Estimate = mean(value),
                   `Std.Err` = sd(value),
  ) %>% 
  dplyr::mutate(" " = key) %>% 
  dplyr::select(" ", Estimate, `Std.Err`) %>% 
  mutate_if(is.double, round, 4) %>% 
  pander(caption = "Bayesian Random County Intercept Model")
```

## Age Bin Sensitivity

```{r age bin sensitivity df, warning=F, cache=T}
who_votes_data_reaged <- who_votes_data
who_votes_data_reaged$age_bin <- as.character(who_votes_data_reaged$age_bin)
who_votes_data_reaged <- who_votes_data_reaged %>% mutate(age_bin = case_when(
  age_bin == "18-29" ~ "18-39",
  age_bin == "30-39" ~ "18-39",
  age_bin == "40-49" ~ "40-64",
  age_bin == "50-64" ~ "40-64",
  age_bin == "65+" ~ "65+",
  TRUE ~ age_bin))
who_votes_data_reaged <- who_votes_data_reaged %>% 
  dplyr::select(everything()) %>% 
  dplyr::group_by(county_desc,age_bin,race_ethnicity,gender,party_cd,cong_dist_abbrv) %>% 
  dplyr::summarise(Likely=sum(Likely),Unlikely=sum(Unlikely)) %>% ungroup() 
who_votes_data_reaged$age_bin <- relevel(who_votes_data_reaged$age_bin %>% as.factor(), ref = "65+")
who_votes_data_reaged$prop = who_votes_data_reaged$Likely/(who_votes_data_reaged$Likely + who_votes_data_reaged$Unlikely)

fold_df_reaged <- groupdata2::fold(who_votes_data_reaged, k = 5, cat_col = c("age_bin", "race_ethnicity", "gender","county_desc")) %>%
  dplyr::mutate(vote = ifelse(Likely/(Unlikely+Likely) > 0.5, 1, 0),
                vote = ifelse(is.nan(Likely/(Unlikely+Likely)), 0, vote),
                vote = dplyr::case_when(
                  Likely == 0 & Unlikely == 0 ~ 0,
                  TRUE ~ vote
                ))
reaged_results <- create_model(mod.ri.county.district.intrxn.age.race.party.race.text, 
                               fold_df_reaged, perform_cv=F)
pander(reaged_results[[3]], caption="Age Bin Sensitivity")
```


